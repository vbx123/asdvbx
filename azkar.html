<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>زاد رمضان - الأذكار</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri&family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .azkar-container { padding: 15px; }
        .zekr-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            transition: 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
        }
        .zekr-text { font-family: 'Amiri', serif; font-size: 1.4rem; line-height: 1.8; margin-bottom: 15px; }
        .zekr-reward { font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 15px; font-style: italic; }
        
        /* تصميم العداد الدائري */
        .progress-container {
            position: relative;
            width: 80px;
            height: 80px;
            margin: 0 auto;
        }
        .progress-ring { transform: rotate(-90deg); }
        .progress-ring__circle {
            stroke-dasharray: 226.19; /* 2 * PI * r (r=36) */
            stroke-dashoffset: 226.19;
            transition: stroke-dashoffset 0.3s, stroke 0.3s;
            stroke-linecap: round;
        }
        .count-number {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .completed { border-color: var(--accent-color); opacity: 0.8; }
        .completed .progress-ring__circle { stroke: #ffd700; filter: drop-shadow(0 0 5px #ffd700); }
    </style>
</head>
<body data-theme="light">

    <header class="top-bar">
        <button class="icon-btn" onclick="handleBack()"><i class="fa-solid fa-arrow-right"></i></button>
        <h1 id="page-title">الأذكار</h1>
        <button class="icon-btn" onclick="window.location.href='support.html'"><i class="fa-solid fa-headset"></i></button>
    </header>

    <div id="azkar-sections" class="category-list"></div>
    <div id="azkar-list" class="azkar-container" style="display: none;"></div>

    <script>
        // مزامنة الثيم
        document.body.setAttribute('data-theme', localStorage.getItem('theme') || 'light');

        let azkarIndex = [];

        async function loadAzkarIndex() {
            const res = await fetch('data/azkar_index.json');
            azkarIndex = await res.json();
            const container = document.getElementById('azkar-sections');
            container.innerHTML = azkarIndex.map((item, index) => `
                <div class="story-card" onclick="loadAzkarList('${item.file}', '${item.category}')">
                    <i class="fa-solid fa-beads"></i>
                    <strong>${item.category}</strong>
                </div>
            `).join('');
        }

        async function loadAzkarList(file, title) {
            document.getElementById('page-title').innerText = title;
            document.getElementById('azkar-sections').style.display = 'none';
            const listContainer = document.getElementById('azkar-list');
            listContainer.style.display = 'block';
            
            const res = await fetch(`data/azkar/${file}`);
            const azkar = await res.json();
            
            listContainer.innerHTML = azkar.map((z, i) => `
                <div class="zekr-card" id="card-${i}" onclick="updateCount(${i}, ${z.count})">
                    <p class="zekr-text">${z.text}</p>
                    ${z.reward ? `<p class="zekr-reward">${z.reward}</p>` : ''}
                    <div class="progress-container">
                        <svg class="progress-ring" width="80" height="80">
                            <circle class="progress-ring__bg" stroke="#e6e6e6" stroke-width="6" fill="transparent" r="36" cx="40" cy="40"/>
                            <circle class="progress-ring__circle" id="circle-${i}" stroke="var(--accent-color)" stroke-width="6" fill="transparent" r="36" cx="40" cy="40"/>
                        </svg>
                        <span class="count-number" id="num-${i}">${z.count}</span>
                    </div>
                </div>
            `).join('');
        }

        function updateCount(id, max) {
            const numEl = document.getElementById(`num-${id}`);
            const circle = document.getElementById(`circle-${id}`);
            const card = document.getElementById(`card-${id}`);
            let current = parseInt(numEl.innerText);

            if (current > 0) {
                current--;
                numEl.innerText = current;
                
                // حساب التقدم الدائري
                const radius = 36;
                const circumference = 2 * Math.PI * radius;
                const offset = circumference - ((max - current) / max) * circumference;
                circle.style.strokeDashoffset = offset;

                // تأثير الهزة عند النقر (Haptic feedback)
                if(window.navigator.vibrate) window.navigator.vibrate(50);

                if (current === 0) {
                    card.classList.add('completed');
                    circle.style.stroke = "#27ae60";
                    // صوت خفيف أو تنبيه عند الانتهاء يمكن إضافته هنا
                }
            }
        }

        function handleBack() {
            if (document.getElementById('azkar-list').style.display === 'block') {
                document.getElementById('azkar-list').style.display = 'none';
                document.getElementById('azkar-sections').style.display = 'grid';
                document.getElementById('page-title').innerText = "الأذكار";
            } else {
                history.back();
            }
        }

        loadAzkarIndex();
    </script>
</body>
</html>
